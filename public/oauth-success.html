<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>OAuth Success</title>
</head>
<body>
  <p>Procesando inicio de sesi√≥n...</p>
  <script>
    // Extraer query params token, usuario y rol
    function getParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    const token = getParam('token');
    const usuario = getParam('usuario');
    const rol = getParam('rol');

    if (token) {
      localStorage.setItem('token', token);
      if (usuario) localStorage.setItem('usuario', decodeURIComponent(usuario));
      if (rol) localStorage.setItem('rol', rol);

      // Registrar auditoria (intentar, pero no bloquear)
      try {
        const API_BASE = window.API_BASE_URL || '';
        fetch(`${API_BASE}/api/auditoria/registrar`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify({ tipo: 'login', usuario: usuario || 'google_user', cuenta: 'google' })
        }).catch(()=>{});
      } catch (e) {}

      // Redirigir a index
      window.location.href = 'index.html';
    } else {
      window.location.href = 'login.html';
    }
  </script>
</body>
</html>